- name: Update system
  hosts: servers
  tasks:
    - name: Ping
      ansible.builtin.ping:

    - name: Update APT
      when: ansible_facts['os_family'] == "Debian"
      changed_when: true
      environment:
        DEBIAN_FRONTEND: noninteractive
        DEBCONF_TERSE: "yes"
        DEBCONF_NOWARNINGS: "yes"
      ansible.builtin.shell: |
        sudo apt-get update
        sudo apt-get upgrade --yes

    - name: Update homelab repository
      changed_when: true
      ansible.builtin.shell: |
        if [ -d "$HOME/git/homelab" ]; then
          cd "$HOME/git/homelab"
        else
          printf 'Directory ~/git/homelab not found\n'
          exit 1
        fi
        git checkout main
        git pull --ff-only
