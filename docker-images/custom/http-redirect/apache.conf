# Custom Apache configuration

ServerName ${HOMELAB_APP_EXTERNAL_DOMAIN}
ServerTokens Prod
DocumentRoot /homelab/www
TraceEnable off
FileETag None
ServerSignature off
DirectoryIndex index.html
Options -Indexes -ExecCGI -Includes -FollowSymLinks -MultiViews
AcceptPathInfo off
DirectorySlash off

# Logging
LogLevel error
ErrorLog /homelab/logs/generic-error.log
CustomLog /homelab/logs/generic-access.log combined
# ForensicLog /homelab/logs/generic-forensic.log

# Remove html response for redirects
# Ideally it would be completely empty, but single char response is the best we can do for now
ErrorDocument 301 "301"
ErrorDocument 302 "302"
ErrorDocument 303 "303"
ErrorDocument 307 "307"
ErrorDocument 308 "308"

<Directory "/homelab/www">
    Options -Indexes -ExecCGI -Includes -FollowSymLinks -MultiViews +SymLinksIfOwnerMatch
    # AllowOverride None
    AllowOverride All
    Require all granted
</Directory>

<Macro CommonAuthStatusSettings>
    # Setup Basic Authentication
    AuthType Basic
    AuthName "Restricted proxy-status endpoint"
    AuthBasicProvider file
    AuthUserFile /homelab/http-user--proxy-status.htpasswd
    Require valid-user
</Macro>

<VirtualHost *:80>
    ServerAlias *

    ErrorLog /homelab/logs/http-error.log
    CustomLog /homelab/logs/http-access.log combined
    # ForensicLog /homelab/logs/http-forensic.log
</VirtualHost>
